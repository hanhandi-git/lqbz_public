三阶段提交时二阶段提交的一种改进版本，为了解决两阶段提交协议的单点故障和同步阻塞问题。

三阶段提交有这么三个阶段：

CanCommit、PreCommit、DoCommit三个阶段

![](https://secure2.wostatic.cn/static/rChF9YADBkPojeKf8vCAXk/image.png?auth_key=1732170549-5DeefJXkB1b1Wa4Q2JjebH-0-af90fdf0fa2ba78bc44ddd9e350ece48)

- CanCommit：准备阶段。协调者向参与者发送commit请求，参与者如果可以提交就返回"Yes"响应，否则就返回"No"响应
- PreCommit：预提交阶段。协调者根据参与者在准备阶段的响应判断是否执行事务还是中断事务，参与者执行完操作之后会返回ACK响应，同时等待最终指令
- DoCommit：提交阶段，协调者根据参与者在准备节点的响应判断是否执行事务还是中断事务。
    - 如果所有参与者都返回正确的ACK响应，则提交事务
    - 如果参与者有一个或多个参与者收到错误的ACK响应或超时，则中断事务
    - 如果参与者无法及时接收到来自协调者的提交或者中断事务请求时，在等待超时之后，会继续进行事务提交

可以看出，三阶段提交解决的只是两阶段提交中**单体故障**和**同步阻塞**的问题，因为加入了超时机制，这里的超时的机制作用于 **预提交阶段** 和 **提交阶段**。如果等待 **预提交请求** 超时，参与者直接回到准备阶段之前。如果等到**提交请求**超时，那参与者就会提交事务了。

**无论是2PC还是3PC都不能保证分布式系统中的数据100%一致**。